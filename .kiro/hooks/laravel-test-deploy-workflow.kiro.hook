{
  "enabled": true,
  "name": "Laravel Testing & Deployment Workflow",
  "description": "Comprehensive testing and deployment readiness workflow for Laravel projects with Filament v4.3+ admin panels and Laravel Boost MCP. Triggers on test file saves, PR creation, or Git branch operations to: scan the codebase for coverage/schemas/configs, generate/update PHPUnit tests for models and Filament resources, run tests and analyze failures with fix suggestions, simulate CI/CD pipeline checks (linting, static analysis, coverage gates), perform quality audits (accessibility, performance, security, translations), and update documentation with coverage reports and changelogs.",
  "version": "1",
  "when": {
    "type": "fileEdited",
    "patterns": [
      "tests/**/*"
    ]
  },
  "then": {
    "type": "askAgent",
    "prompt": "A test file in the tests/ directory has been modified. Execute the merged comprehensive Laravel testing and deployment workflow:\n\n## 1. Codebase Analysis with Laravel Boost MCP\n- Scan the entire codebase to extract:\n  - Current test coverage data, gaps, and trends (target >= 90%)\n  - Model schemas, relationships, validations, casts, CRUD operations, events/observers, and scopes\n  - Filament v4.3+ resource configurations (forms, tables, actions, relation managers)\n  - Custom field definitions, enum configurations, custom pages/widgets/dashboards\n  - Tenant/team scoping rules and authorization policies\n  - Potential N+1 hotspots and indexing needs\n\n## 2. Generate or Update PHPUnit/Pest Tests\nFor **Models**:\n- CRUD coverage (create, read, update, delete)\n- Validation rules and business logic (invalid inputs, boundary conditions, null handling)\n- Relationship integrity (hasMany, belongsTo, morphMany, etc.)\n- Events, observers, scopes, and authorization via policies\n\nFor **Filament Resources**:\n- Form::schema submissions with valid/invalid data and live validation\n- Table::columns filtering, searching, sorting, and pagination\n- Action handling (create, edit, delete, bulk actions, custom actions)\n- Relation manager interactions and nested resource operations\n- Custom pages, widgets, dashboards; reactive components; slideOvers/wizards\n- Authorization failures, tenant scoping, and permission checks\n\nFor **Edge Cases**:\n- Invalid inputs and validation failures\n- Authorization failures (403 responses, missing permissions)\n- Boundary conditions, null values, concurrency/race conditions\n- Database constraints, foreign key violations, N+1 query detection\n- Empty states and error handling\n\n## 3. Run All Tests and Analyze Failures\n- Execute: `composer test` or `php artisan test --parallel`\n- Execute: `composer test:coverage` to confirm coverage (target >= 90%)\n- Analyze failures with detailed explanations and code diffs\n- Provide Filament v4.3+-specific guidance (unified Actions, Schema system, auto-tenancy) and performance optimizations\n- If coverage is below target: identify uncovered paths and generate additional tests prioritizing critical business logic and user flows\n\n## 4. Simulate CI/CD Pipeline Checks\n- If on a git branch (`.git` present): run `composer lint` (Pint + Rector), `composer test:types` or `phpstan analyse`, `composer test:type-coverage` (min 99.9%), `pint --test`, and ensure `ArchTest.php` rules pass\n- For Filament dashboards: verify widget data integrity, real-time updates/polling, tenant scoping, query counts, eager loading, pagination sanity (prefer simple pagination for large datasets), and defer heavy columns (`->lazy()`, `->deferLoading()`)\n\n## 5. Quality Audit\n- **Accessibility**: ARIA labels on form fields, proper labels (not placeholders), semantic HTML, keyboard navigation, and color contrast\n- **Performance**: detect N+1 queries, suggest eager loading, check indexes on searchable/sortable columns, validate pagination, and cache/defer expensive work where appropriate\n- **Security**: middleware on routes/resources, authorization gates (canViewAny/canCreate/canEdit/canDelete), SQL injection checks, CSRF protection, mass assignment safety, tenant isolation\n- **Translations**: no hardcoded strings; use `__()` keys; ensure enum labels return translated values\n- Apply fixes after confirmation, following Laravel and Filament v4.3+ best practices\n\n## 6. Documentation\n- Update `tests/README.md` with coverage %, trends, suite summary (Feature/Unit/Integration), run instructions, coverage gaps, recommendations, and performance benchmarks\n- Generate a changelog snippet for the session: new tests added, coverage improvements, bugs fixed, performance optimizations, breaking changes (if any)\n\n## 7. Output & Notifications\n- Use advanced AI reasoning and provide actionable recommendations with code examples\n- Prioritize Filament v4.3+ specifics (unified actions, schema system, OKLCH colors, auto-tenancy) and translation guidelines\n- Notify via Kiro IDE alerts when test generation is complete, test execution finishes with a pass/fail summary, coverage analysis is ready, quality audit identifies critical issues, and documentation updates are committed\n- Provide a summary report: coverage before/after, tests added/updated, failures with suggested fixes, quality audit findings, CI/CD simulation results, and next steps"
  },
  "workspaceFolderName": "crm",
  "shortName": "laravel-test-deploy-workflow"
}
