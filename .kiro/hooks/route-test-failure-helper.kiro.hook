{
<<<<<<< HEAD
=======
  "enabled": true,
  "name": "Route Test Failure Helper",
  "description": "Provides guidance when route tests fail, helping developers quickly identify and fix issues",
  "version": "1",
  "when": {
    "type": "userTriggered"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Provide comprehensive troubleshooting guidance for route test failures:\n\n# Route Test Failure Troubleshooting Guide\n\n## Common Issues and Solutions\n\n### 1. Route Not Found\n\n**Symptoms:**\n- Test fails with \"Route [route.name] not defined\"\n- 404 Not Found error\n\n**Solutions:**\n```bash\n# Check if route exists\nphp artisan route:list | grep route.name\n\n# Clear route cache\nphp artisan route:clear\nphp artisan optimize:clear\n\n# Verify route is registered in routes/ files\n```\n\n**Fix:**\n- Add route to appropriate routes file\n- Ensure route name matches test\n- Check route group prefixes\n\n---\n\n### 2. Authentication Required\n\n**Symptoms:**\n- Test fails with 401 Unauthorized\n- Redirect to login page\n\n**Solutions:**\n```php\n// Add authentication to test\n$user = User::factory()->create();\n\nrouteTesting()\n    ->actingAs($user)\n    ->only(['protected.route'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Add `->actingAs($user)` to test\n- Ensure user has required permissions\n- Check middleware configuration\n\n---\n\n### 3. Missing Route Parameters\n\n**Symptoms:**\n- Test fails with \"Missing required parameter\"\n- Route expects model but none provided\n\n**Solutions:**\n```php\n// Bind required models\n$note = Note::factory()->create();\n\nrouteTesting()\n    ->actingAs($user)\n    ->bind('note', $note)\n    ->only(['notes.print'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Add `->bind('param', $model)` to test\n- Create model with factory\n- Ensure tenant scoping is correct\n\n---\n\n### 4. Tenant Scoping Issues\n\n**Symptoms:**\n- Test fails with 403 Forbidden\n- Model belongs to different team\n\n**Solutions:**\n```php\n// Create model in user's team\n$user = User::factory()->create();\n$note = Note::factory()->create([\n    'team_id' => $user->currentTeam->id,\n]);\n\nrouteTesting()\n    ->actingAs($user)\n    ->bind('note', $note)\n    ->only(['notes.print'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Ensure model belongs to user's team\n- Check tenant middleware\n- Verify team relationships\n\n---\n\n### 5. API Token Issues\n\n**Symptoms:**\n- API test fails with 401 Unauthorized\n- Token not accepted\n\n**Solutions:**\n```php\n// Create Sanctum token\n$user = User::factory()->create();\n$token = $user->createToken('test')->plainTextToken;\n\nrouteTesting()\n    ->withToken($token)\n    ->only(['api.route'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Add `->withToken($token)` to test\n- Ensure Sanctum is configured\n- Check API middleware\n\n---\n\n### 6. Middleware Conflicts\n\n**Symptoms:**\n- Test fails unexpectedly\n- Middleware blocking access\n\n**Solutions:**\n```php\n// Skip middleware (use sparingly)\nrouteTesting()\n    ->withoutMiddleware()\n    ->only(['route'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Review middleware stack\n- Ensure proper authentication\n- Check middleware configuration\n\n---\n\n### 7. Signed URL Routes\n\n**Symptoms:**\n- Test fails with \"Invalid signature\"\n- Signed route not accessible\n\n**Solutions:**\n```php\n// Generate signed URL\n$url = URL::signedRoute('verification.verify', [\n    'id' => $user->id,\n    'hash' => sha1($user->email),\n]);\n\n$this->actingAs($user)\n    ->get($url)\n    ->assertRedirect();\n```\n\n**Fix:**\n- Use `URL::signedRoute()` to generate URL\n- Don't use `routeTesting()` for signed routes\n- Test manually with proper signature\n\n---\n\n### 8. Missing Test Configuration\n\n**Symptoms:**\n- Route not in any test file\n- Coverage test fails\n\n**Solutions:**\n1. Add route to `RouteTestingConfig`:\n```php\npublic static function authenticatedRoutes(): array\n{\n    return [\n        'dashboard',\n        'calendar',\n        'your.new.route', // Add here\n    ];\n}\n```\n\n2. Create test:\n```php\nit('can access new route', function (): void {\n    $user = User::factory()->create();\n    \n    routeTesting()\n        ->actingAs($user)\n        ->only(['your.new.route'])\n        ->assertAllRoutesAreAccessible();\n});\n```\n\n**Fix:**\n- Add route to appropriate config array\n- Create test in appropriate test file\n- Run tests to verify\n\n---\n\n## Quick Diagnostic Commands\n\n```bash\n# List all routes\nphp artisan route:list\n\n# List routes with specific name\nphp artisan route:list | grep route.name\n\n# Clear all caches\nphp artisan optimize:clear\n\n# Run specific test file\npest tests/Feature/Routes/YourTestFile.php\n\n# Run with verbose output\npest tests/Feature/Routes/YourTestFile.php -v\n\n# Run single test\npest tests/Feature/Routes/YourTestFile.php --filter=\"test name\"\n```\n\n---\n\n## Updating RouteTestingConfig\n\n### Add Public Route\n```php\npublic static function publicRoutes(): array\n{\n    return [\n        'home',\n        'terms.show',\n        'your.new.route', // Add here\n    ];\n}\n```\n\n### Add Authenticated Route\n```php\npublic static function authenticatedRoutes(): array\n{\n    return [\n        'dashboard',\n        'your.new.route', // Add here\n    ];\n}\n```\n\n### Add Parametric Route\n```php\npublic static function parametricRoutes(): array\n{\n    return [\n        'notes.print' => ['note'],\n        'your.new.route' => ['model'], // Add here\n    ];\n}\n```\n\n### Exclude Route from Testing\n```php\npublic static function excludedRoutes(): array\n{\n    return [\n        'telescope.*',\n        'your.complex.route', // Add here\n    ];\n}\n```\n\n---\n\n## Need More Help?\n\n1. **Check Documentation:**\n   - `docs/pest-route-testing-complete-guide.md`\n   - `docs/pest-route-testing-integration.md`\n   - `.kiro/steering/pest-route-testing.md`\n\n2. **Review Examples:**\n   - `tests/Feature/Routes/PublicRoutesTest.php`\n   - `tests/Feature/Routes/AuthenticatedRoutesTest.php`\n   - `tests/Feature/Routes/ApiRoutesTest.php`\n\n3. **Check Package Docs:**\n   - https://github.com/spatie/pest-plugin-route-testing\n\n4. **Run Diagnostics:**\n   ```bash\n   php artisan route:list\n   composer test:routes\n   ```\n\nProvide specific guidance based on the current test failures if any are detected."
  },
  "workspaceFolderName": "crm",
  "shortName": "route-test-failure-helper"
}
      "content": "# Route Test Failure Troubleshooting Guide\n\n## Common Issues and Solutions\n\n### 1. Route Not Found\n\n**Symptoms:**\n- Test fails with \"Route [route.name] not defined\"\n- 404 Not Found error\n\n**Solutions:**\n```bash\n# Check if route exists\nphp artisan route:list | grep route.name\n\n# Clear route cache\nphp artisan route:clear\nphp artisan optimize:clear\n\n# Verify route is registered in routes/ files\n```\n\n**Fix:**\n- Add route to appropriate routes file\n- Ensure route name matches test\n- Check route group prefixes\n\n---\n\n### 2. Authentication Required\n\n**Symptoms:**\n- Test fails with 401 Unauthorized\n- Redirect to login page\n\n**Solutions:**\n```php\n// Add authentication to test\n$user = User::factory()->create();\n\nrouteTesting()\n    ->actingAs($user)\n    ->only(['protected.route'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Add `->actingAs($user)` to test\n- Ensure user has required permissions\n- Check middleware configuration\n\n---\n\n### 3. Missing Route Parameters\n\n**Symptoms:**\n- Test fails with \"Missing required parameter\"\n- Route expects model but none provided\n\n**Solutions:**\n```php\n// Bind required models\n$note = Note::factory()->create();\n\nrouteTesting()\n    ->actingAs($user)\n    ->bind('note', $note)\n    ->only(['notes.print'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Add `->bind('param', $model)` to test\n- Create model with factory\n- Ensure tenant scoping is correct\n\n---\n\n### 4. Tenant Scoping Issues\n\n**Symptoms:**\n- Test fails with 403 Forbidden\n- Model belongs to different team\n\n**Solutions:**\n```php\n// Create model in user's team\n$user = User::factory()->create();\n$note = Note::factory()->create([\n    'team_id' => $user->currentTeam->id,\n]);\n\nrouteTesting()\n    ->actingAs($user)\n    ->bind('note', $note)\n    ->only(['notes.print'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Ensure model belongs to user's team\n- Check tenant middleware\n- Verify team relationships\n\n---\n\n### 5. API Token Issues\n\n**Symptoms:**\n- API test fails with 401 Unauthorized\n- Token not accepted\n\n**Solutions:**\n```php\n// Create Sanctum token\n$user = User::factory()->create();\n$token = $user->createToken('test')->plainTextToken;\n\nrouteTesting()\n    ->withToken($token)\n    ->only(['api.route'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Add `->withToken($token)` to test\n- Ensure Sanctum is configured\n- Check API middleware\n\n---\n\n### 6. Middleware Conflicts\n\n**Symptoms:**\n- Test fails unexpectedly\n- Middleware blocking access\n\n**Solutions:**\n```php\n// Skip middleware (use sparingly)\nrouteTesting()\n    ->withoutMiddleware()\n    ->only(['route'])\n    ->assertAllRoutesAreAccessible();\n```\n\n**Fix:**\n- Review middleware stack\n- Ensure proper authentication\n- Check middleware configuration\n\n---\n\n### 7. Signed URL Routes\n\n**Symptoms:**\n- Test fails with \"Invalid signature\"\n- Signed route not accessible\n\n**Solutions:**\n```php\n// Generate signed URL\n$url = URL::signedRoute('verification.verify', [\n    'id' => $user->id,\n    'hash' => sha1($user->email),\n]);\n\n$this->actingAs($user)\n    ->get($url)\n    ->assertRedirect();\n```\n\n**Fix:**\n- Use `URL::signedRoute()` to generate URL\n- Don't use `routeTesting()` for signed routes\n- Test manually with proper signature\n\n---\n\n### 8. Missing Test Configuration\n\n**Symptoms:**\n- Route not in any test file\n- Coverage test fails\n\n**Solutions:**\n1. Add route to `RouteTestingConfig`:\n```php\npublic static function authenticatedRoutes(): array\n{\n    return [\n        'dashboard',\n        'calendar',\n        'your.new.route', // Add here\n    ];\n}\n```\n\n2. Create test:\n```php\nit('can access new route', function (): void {\n    $user = User::factory()->create();\n    \n    routeTesting()\n        ->actingAs($user)\n        ->only(['your.new.route'])\n        ->assertAllRoutesAreAccessible();\n});\n```\n\n**Fix:**\n- Add route to appropriate config array\n- Create test in appropriate test file\n- Run tests to verify\n\n---\n\n## Quick Diagnostic Commands\n\n```bash\n# List all routes\nphp artisan route:list\n\n# List routes with specific name\nphp artisan route:list | grep route.name\n\n# Clear all caches\nphp artisan optimize:clear\n\n# Run specific test file\npest tests/Feature/Routes/YourTestFile.php\n\n# Run with verbose output\npest tests/Feature/Routes/YourTestFile.php -v\n\n# Run single test\npest tests/Feature/Routes/YourTestFile.php --filter=\"test name\"\n```\n\n---\n\n## Updating RouteTestingConfig\n\n### Add Public Route\n```php\npublic static function publicRoutes(): array\n{\n    return [\n        'home',\n        'terms.show',\n        'your.new.route', // Add here\n    ];\n}\n```\n\n### Add Authenticated Route\n```php\npublic static function authenticatedRoutes(): array\n{\n    return [\n        'dashboard',\n        'your.new.route', // Add here\n    ];\n}\n```\n\n### Add Parametric Route\n```php\npublic static function parametricRoutes(): array\n{\n    return [\n        'notes.print' => ['note'],\n        'your.new.route' => ['model'], // Add here\n    ];\n}\n```\n\n### Exclude Route from Testing\n```php\npublic static function excludedRoutes(): array\n{\n    return [\n        'telescope.*',\n        'your.complex.route', // Add here\n    ];\n}\n```\n\n---\n\n## Need More Help?\n\n1. **Check Documentation:**\n   - `docs/pest-route-testing-complete-guide.md`\n   - `docs/pest-route-testing-integration.md`\n   - `.kiro/steering/pest-route-testing.md`\n\n2. **Review Examples:**\n   - `tests/Feature/Routes/PublicRoutesTest.php`\n   - `tests/Feature/Routes/AuthenticatedRoutesTest.php`\n   - `tests/Feature/Routes/ApiRoutesTest.php`\n\n3. **Check Package Docs:**\n   - https://github.com/spatie/pest-plugin-route-testing\n\n4. **Run Diagnostics:**\n   ```bash\n   php artisan route:list\n   composer test:routes\n   ```"
    }
  ],
>>>>>>> d03887dc78a6e1a0c2ed674137398a067503335e
  "enabled": true,
  "name": "Route Test Failure Helper",
  "description": "Provides comprehensive guidance when route tests fail, helping developers quickly identify and fix issues",
  "version": "1",
  "when": {
    "type": "userTriggered"
  },
  "then": {
    "type": "askAgent",
    "prompt": "Provide comprehensive troubleshooting guidance for route test failures. Include:\n\n## 1. Common Issues Analysis\n- Route Not Found (404 errors, undefined routes)\n- Authentication Required (401 errors, login redirects)\n- Missing Route Parameters (model binding issues)\n- Tenant Scoping Issues (403 errors, team mismatches)\n- API Token Issues (Sanctum authentication)\n- Middleware Conflicts (unexpected blocks)\n- Signed URL Routes (invalid signatures)\n- Missing Test Configuration (uncovered routes)\n\n## 2. Diagnostic Commands\nProvide commands to:\n- List all routes (`php artisan route:list`)\n- Clear caches (`php artisan optimize:clear`)\n- Run specific tests with verbose output\n- Filter and search routes\n\n## 3. Code Examples\nFor each issue type, provide:\n- Symptoms to look for\n- Working code examples with proper setup\n- Factory usage for test data\n- Proper authentication patterns\n- Model binding examples\n- Tenant scoping patterns\n\n## 4. RouteTestingConfig Updates\nShow how to:\n- Add routes to public/authenticated/API arrays\n- Configure parametric routes with bindings\n- Exclude complex routes from testing\n- Organize routes by category\n\n## 5. Quick Fixes\n- Authentication: `->actingAs($user)`\n- Model binding: `->bind('param', $model)`\n- API tokens: `->withToken($token)`\n- Tenant scoping: ensure models belong to user's team\n\n## 6. Documentation References\n- Link to `docs/pest-route-testing-complete-guide.md`\n- Link to `docs/pest-route-testing-integration.md`\n- Link to `.kiro/steering/pest-route-testing.md`\n- Link to package documentation\n\n## 7. Next Steps\n- Run diagnostics\n- Update configuration\n- Create missing tests\n- Verify fixes\n\nProvide this as a comprehensive, well-organized troubleshooting guide with code examples and clear explanations."
  },
  "workspaceFolderName": "crm",
  "shortName": "route-test-failure-helper"
}
