---
inclusion: always
---

- Base models that are meant to be extended (e.g., `ProcessDefinition` used by `WorkflowDefinition`) must not be declared `final`; keep them extendable to avoid inheritance errors.
- Avoid hardcoded product labels; use the `brand_name()` helper (config-driven, falls back to `laravel-crm.ui.brand_name` / `app.name`) for titles, meta tags, and UI copy instead of literal strings.
- When adding creator/auditing support to a model, use the shared `HasCreator` trait (wrapping Laravel Userstamps) and ensure migrations include `creator_id`, `editor_id`, and `deleted_by` (for SoftDeletes) columns; prefer `updateWithUserstamps`/`deleteWithUserstamps` for bulk writes so `editor_id`/`deleted_by` stay accurate.
- Prefer `App\Support\Helpers\ArrayHelper` (wrapping Laravel's `Arr` helpers) for array/JSON formatting in Filament tables, infolists, exports, and notifications; avoid manual `implode()` so mixed states (JSON strings vs. arrays) are normalized and trimmed consistently.
- Wrap long text for Filament tables/infolists with `App\Support\Helpers\StringHelper::wordWrap()` (e.g., `break: '<br>'`, `cutLongWords: true`) instead of manual `wordwrap()`/inline CSS so narrow columns stay readable without unsafe HTML.
- Outbound HTTP requests should use the shared macros (`Http::external`, `Http::github`) configured in `config/http-clients.php` so retries (429/5xx + connection errors), timeouts, and the brand-aware user agent remain consistent; tests should prefer `Http::fake()`/`Http::preventStrayRequests()` with sequences for retry paths.
- Baseline security headers (including CSP) are centralized in `config/security.php` and enforced via `ApplySecurityHeaders` + `SecurityHeaders`; tune directives there instead of setting ad-hoc headers, and keep `/.well-known/security.txt` populated through config so researchers can reach us.
- Security headers are applied globally via `App\Http\Middleware\ApplySecurityHeaders` (Treblle package); keep it in `bootstrap/app.php`, adjust values with `SECURITY_HEADERS_*` + `config/headers.php`, and use `headers.except` for special-case paths instead of removing the middleware or disabling HSTS in production.
- Use Laravel Pail for real-time log tailing (PCNTL required); prefer `php artisan pail --timeout=0` with `--filter/--message/--level/--user` instead of `tail -f` so stack drivers (including Sentry/Flare) are covered—see `docs/laravel-pail.md` and the Filament "Log streaming" page for presets.
- Application models should extend the shared `App\Models\Model` base (bundles `LaracraftTech\LaravelDateScopes\DateScopes`); drop direct `Illuminate\Database\Eloquent\Model` imports in app models and favor the package scopes/`DateScopeFilter` instead of hand-rolled Carbon `whereBetween` date ranges when filtering timestamps.
- Use `App\Models\InMemoryModel` (Truffle) for static reference datasets and fixtures; define `$records`/`$schema` on the model instead of hand-rolled SQLite connections or array lookups so in-memory data still flows through Eloquent, DateScopes, and shared model conventions.
- Services should use constructor injection with readonly properties (PHP 8.4+); register in `AppServiceProvider::register()` using `bind()` or `singleton()`, and avoid service locator pattern (`app()`, `resolve()`) in business logic—see `.kiro/steering/laravel-container-services.md` for patterns and best practices.
- Use `Blaspsoft\Onym\Facades\Onym` for ALL filename generation (uploads, exports, temporary files); prefer UUIDs (`Onym::uuid()`) for storage safety and Slugs (`Onym::slug()`) for public-facing URLs, ensuring consistent, sanitized naming across the application—see `docs/laravel-onym-integration.md`.
